rules:
  # TERM LIMITS - Conditional based on existing terms
  - id: term_limit_perpetual
    type: confidentiality_term
    pattern: '\b(?:perpetual|indefinite|no\s+expir(?:ation|y)|without\s+(?:time\s+)?limit)\b'
    severity: critical
    action: replace
    replacement: 'for a period of two (2) years following the date hereof'
    explanation: "Replace perpetual/indefinite terms with reasonable 2-year limit"
    check_existing: false  # Always flag perpetual terms

  - id: term_limit_excessive
    type: confidentiality_term
    pattern: '(?:period\s+of\s+)?(\d+)\s*years?'
    severity: moderate
    action: replace
    replacement: 'two (2) years'
    explanation: "Replace excessive term (>5 years) with standard 2-year term"
    check_existing: true
    acceptable_range: [1, 5]  # Only flag if outside 1-5 year range
    ideal_range: [1.5, 3]  # 18-36 months

  - id: term_limit_no_expiration
    type: confidentiality_term
    pattern: '(?:obligations?\s+(?:of|under)\s+this\s+Agreement\s+shall\s+(?:survive|continue|remain))(?!.*?(?:period|term|months?|years?))'
    addition: 'for a period of two (2) years following the date hereof'
    severity: high
    action: add_inline
    explanation: "Add term limit where none exists"
    check_existing: true  # Only add if no term is specified

  # GOVERNING LAW - Only flag unusual jurisdictions
  - id: governing_law_unusual_jurisdiction
    type: governing_law
    pattern: '(?:governed|construed|interpreted)\s+(?:by|in\s+accordance\s+with)\s+(?:the\s+)?laws\s+of\s+(?:the\s+)?(?:State\s+of\s+)?(?!Delaware|New\s+York|California|Texas|Illinois|Massachusetts)([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)'
    replacement: 'governed by and construed in accordance with the laws of the State of Delaware'
    severity: moderate
    action: replace
    explanation: "Change unusual jurisdiction to Delaware (accepted: DE, NY, CA, TX, IL, MA)"
    check_existing: true
    acceptable_jurisdictions: ['Delaware', 'New York', 'California', 'Texas', 'Illinois', 'Massachusetts']

  # DOCUMENT RETENTION - Only add carveout if missing
  - id: retention_carveout
    type: document_retention
    pattern: '(?:return|destroy).*?(?:all|any).*?(?:Confidential\s+)?(?:Information|documents|materials)(?!.*?(?:legal|regulatory|archival))'
    addition: 'Notwithstanding the foregoing, Recipient may retain copies of Confidential Information as necessary for legal, regulatory, or archival purposes, or as required by regulation, or legal process, provided such retained information remains subject to the confidentiality obligations herein.'
    severity: high
    action: add_after
    explanation: "Add legal/regulatory/archival retention carveout"
    check_existing: true  # Only add if carveout doesn't exist

  - id: return_destroy_option
    type: document_retention
    pattern: '\b(?:shall|must)\s+return\b(?!.*?or\s+destroy)'
    replacement: 'shall, upon request, either return or destroy'
    severity: moderate
    action: replace
    explanation: "Allow destruction option for confidential materials"
    check_existing: true  # Only modify if option is missing

  # NON-SOLICIT CARVEOUTS - Only add missing exceptions
  - id: non_solicit_carveouts
    type: employee_solicitation
    pattern: '(?:shall\s+not|will\s+not|agree\s+not\s+to)\s+(?:directly\s+or\s+indirectly\s+)?(?:solicit|hire|employ).*?(?:employee|personnel)(?!.*?(?:general\s+advertisement|employee-initiated|prior\s+(?:employment\s+)?discussion|terminated))'
    addition: |
      Nothing herein shall prevent Recipient from hiring such persons who: (i) respond to general advertisements or recruiting efforts not specifically directed at the Disclosing Party's employees; (ii) initiate discussions with Recipient without any direct or indirect solicitation; (iii) had prior employment discussions with Recipient before receiving Confidential Information; or (iv) were terminated by the Disclosing Party prior to commencement of discussions with Recipient.
    severity: high
    action: add_after
    explanation: "Add standard non-solicit carveouts (only if <2 exceptions exist)"
    check_existing: true  # Only add if missing
    min_exceptions_required: 2  # Only flag if less than 2 exceptions present

  # AFFILIATE REMOVAL - Lower priority
  - id: remove_affiliate_references
    type: affiliate_clause
    pattern: '\b(?:and|or|including)\s+(?:its|our|their)\s+affiliates?\b'
    severity: low
    action: delete
    explanation: "Remove affiliate references (limit to named parties)"
    check_existing: true

  - id: remove_affiliate_standalone
    type: affiliate_clause
    pattern: ',?\s*(?:subsidiaries|affiliates|parents|related\s+entities),?\s*'
    severity: low
    action: delete
    explanation: "Remove affiliate/subsidiary references"
    check_existing: true

  # LEGAL MODIFIERS - Low priority improvements
  - id: best_efforts_to_commercially_reasonable
    type: legal_modifier
    pattern: '\bbest\s+efforts?\b'
    replacement: 'commercially reasonable efforts'
    severity: low
    action: replace
    explanation: "Change 'best efforts' to 'commercially reasonable efforts'"
    check_existing: true

  - id: remove_sole_discretion
    type: legal_modifier
    pattern: '\b(?:sole|absolute)\s+discretion\b'
    replacement: 'reasonable discretion'
    severity: low
    action: replace
    explanation: "Moderate discretion language"
    check_existing: true

  # COMPETITION SAFE HARBOR - High priority, add if missing
  - id: competition_disclaimer
    type: competition_clause
    pattern: '(?:Confidential\s+Information|this\s+Agreement)(?!.*?(?:will\s+not|shall\s+not).*?(?:prevent|preclude|restrict).*?(?:business|compet))'
    addition: |
      Recipient's receipt and use of Confidential Information will not, in and of itself, prevent or restrict Recipient in any way from carrying on its business in the ordinary course, including without limitation, making investments in, acquisitions of, or competing with businesses similar to or competitive with Disclosing Party.
    severity: high
    action: add_after
    context_required: 'confidential.*information.*disclosed'
    explanation: "Add competition safe harbor language"
    check_existing: true  # Only add if safe harbor doesn't exist

  # INJUNCTIVE RELIEF MODIFICATION - Moderate, add if missing
  - id: injunctive_relief_balance
    type: injunctive_relief
    pattern: '(?:entitled|right)\s+to\s+(?:seek\s+)?injunctive\s+relief(?!.*?upon.*?(?:final|binding).*?determination)'
    addition: ', upon a final binding determination of a court of competent jurisdiction,'
    severity: moderate
    action: add_inline
    explanation: "Require court determination for injunctive relief"
    check_existing: true  # Only add if court determination requirement missing

  # REPRESENTATIONS AND WARRANTIES - Moderate priority
  - id: remove_accuracy_representation
    type: representations
    pattern: '(?:represent|warrant).*?(?:accuracy|completeness|correctness).*?(?:Information|materials)'
    severity: moderate
    action: delete
    explanation: "Remove representations about information accuracy (information provided as-is)"
    check_existing: true

  - id: remove_ownership_representation
    type: representations
    pattern: '(?:represent|warrant).*?(?:own|ownership|right|title).*?(?:Information|materials)'
    severity: moderate
    action: delete
    explanation: "Remove ownership representations (not warranting ownership)"
    check_existing: true

  # INDEMNIFICATION - High priority (delete always)
  - id: remove_indemnification
    type: indemnification
    pattern: '(?:shall\s+)?(?:indemnify|hold\s+harmless).*?(?:from|against).*?(?:claim|loss|damage|liability)'
    severity: high
    action: delete
    explanation: "Remove indemnification clauses (never indemnify for NDA breaches)"
    check_existing: false  # Always remove

  # BROKER/COMMISSION LANGUAGE - High priority (delete always)
  - id: remove_broker_commission
    type: broker_clause
    pattern: '(?:Broker|commission|brokerage).*?(?:paid|due|entitled).*?(?:at\s+closing|upon\s+sale)'
    severity: high
    action: delete
    explanation: "Remove broker/commission language (not relevant to NDAs)"
    check_existing: false  # Always remove

  # ASSIGNMENT RESTRICTIONS - Moderate priority
  - id: allow_assignment
    type: assignment
    pattern: 'may\s+not\s+(?:be\s+)?assign(?:ed)?.*?without.*?(?:prior\s+)?(?:written\s+)?consent'
    replacement: 'may be assigned to affiliates or in connection with a merger, acquisition, or sale of all or substantially all assets'
    severity: moderate
    action: replace
    explanation: "Allow assignment in M&A situations (standard practice)"
    check_existing: true

  # JURISDICTION/VENUE - Low priority
  - id: remove_specific_venue
    type: jurisdiction
    pattern: '(?:exclusive\s+)?(?:jurisdiction|venue).*?(?:court|County|District)'
    severity: low
    action: delete
    explanation: "Remove specific venue requirements"
    check_existing: true

  # WRITTEN REQUEST FOR RETURN - Moderate priority
  - id: require_written_request
    type: document_retention
    pattern: '(?:shall|must|will)\s+(?:immediately\s+)?(?:return|destroy)(?!.*?(?:upon|following)\s+(?:written\s+)?request)'
    replacement: 'shall, upon written request,'
    severity: moderate
    action: add_inline
    explanation: "Require written request for return/destruction (not automatic)"
    check_existing: true
